<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>WebSocket JSON Message Tester</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #222;
            color: #eee;
            margin: 20px;
        }

        input,
        button,
        textarea {
            font-family: Courier New, monospace;
            font-size: 14px;
        }

        textarea {
            width: 100%;
            height: 220px;
            background: #111;
            color: #0f0;
            padding: 10px;
            border: 1px solid #555;
            resize: vertical;
        }

        button {
            margin-top: 6px;
            margin-right: 10px;
            cursor: pointer;
        }

        label {
            display: inline-block;
            margin-top: 8px;
        }

        #status {
            font-weight: bold;
        }
    </style>
</head>

<body>

    <h2>WebSocket JSON Tester</h2>

    <label>WebSocket URL:</label><br />
    <input id="ws-url" type="text" value="ws://localhost:3000/ws/echo" style="width: 400px;" />
    <button onclick="connectWS()">Connect</button>
    <button onclick="disconnectWS()">Disconnect</button>

    <br /><br />

    <label>Message type (<code>type</code>):</label><br />
    <input id="msg-type" type="text" value="test" style="width: 200px;" />

    <br />

    <label>Message Data (<code>Data</code>):</label><br />
    <textarea id="msg-data" placeholder='Examples:
"hello"
123
{"foo": "bar"}
[1,2,3]
'></textarea>

    <br />
    <button onclick="sendWS()">Send Message</button>

    <br /><br />

    <label>Log:</label><br />
    <textarea id="output" readonly></textarea>

    <br /><br />

    <strong>Status:</strong> <span id="status">Disconnected</span>

    <script>
        let ws = null;

        function log(msg) {
            const out = document.getElementById("output");
            const time = new Date().toISOString();
            out.value += "[" + time + "] " + msg + "\n";
            out.scrollTop = out.scrollHeight;
        }

        function connectWS() {
            const url = document.getElementById("ws-url").value.trim();
            if (!url) {
                alert("Please enter a WebSocket URL.");
                return;
            }

            if (ws && ws.readyState === WebSocket.OPEN) {
                log("Already connected.");
                return;
            }

            log("Connecting to " + url + " ...");
            ws = new WebSocket(url);

            ws.onopen = () => {
                log("CONNECTED");
                setStatus("Connected", "lightgreen");
            };

            ws.onmessage = (event) => {
                let msgText = event.data;
                try {
                    const obj = JSON.parse(event.data);
                    msgText = JSON.stringify(obj, null, 2);
                } catch (e) {
                    // not JSON, keep raw
                }
                log("RECEIVED:\n" + msgText);
            };

            ws.onerror = (event) => {
                log("ERROR: " + event);
                setStatus("Error", "orange");
            };

            ws.onclose = () => {
                log("DISCONNECTED");
                setStatus("Disconnected", "red");
            };
        }

        function sendWS() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log("Cannot send: WebSocket is not connected.");
                return;
            }

            const type = document.getElementById("msg-type").value.trim();
            const rawData = document.getElementById("msg-data").value.trim();

            if (!type) {
                alert("Please provide a message type.");
                return;
            }

            const msg = { type: type }; // matches `json:"type"`

            if (rawData !== "") {
                // Try to parse JSON for Data; if fails, send as string.
                let parsed;
                try {
                    parsed = JSON.parse(rawData);
                } catch (e) {
                    parsed = rawData;
                }
                msg.data = parsed; // matches `json:"Data"` (capital D)
            }

            const payload = JSON.stringify(msg);
            log("SENDING:\n" + payload);
            ws.send(payload);
        }

        function disconnectWS() {
            if (ws) {
                log("Closing connection...");
                ws.close();
            }
        }

        function setStatus(text, color) {
            const el = document.getElementById("status");
            el.textContent = text;
            el.style.color = color;
        }
    </script>

</body>

</html>